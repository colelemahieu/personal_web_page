<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>USS Enterprise Asteroid Dodge</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: black;
      color: white;
      font-family: sans-serif;
      text-align: center;
      overflow: hidden; /* prevent scrollbars */
    }

    #gameContainer {
      display: none;
      margin: 2rem auto;
      border: 2px solid white;
      background-color: #111;
      padding: 1rem;
      width: 80%;
      max-width: 600px;
      aspect-ratio: 3/2;
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    #highScoresBox {
      margin-top: 2rem;
      border: 1px solid white;
      padding: 1rem;
      background-color: #222;
      width: 80%;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }

    button {
      padding: 0.5rem 1rem;
      margin-top: 1rem;
      background-color: white;
      color: black;
      font-weight: bold;
      cursor: pointer;
    }

    /* Fullscreen styles */
    :fullscreen #gameContainer,
    :-webkit-full-screen #gameContainer {
      width: 100vw;
      height: 100vh;
      max-width: none;
      aspect-ratio: unset;
    }

    :fullscreen canvas,
    :-webkit-full-screen canvas {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <h1>USS Enterprise Asteroid Dodge</h1>
  <div id="initialPrompt">
    <p>Dodge the asteroids with the arrow keys!</p>
    <button onclick="startGame()">Start Game</button>
  </div>

  <div id="gameContainer">
    <canvas id="gameCanvas" width="600" height="400"></canvas>
  </div>

  <div id="highScoresBox">
    <h2>High Scores</h2>
    <ol id="highScoresList"></ol>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const gameContainer = document.getElementById('gameContainer');
    const highScoresBox = document.getElementById('highScoresBox');
    const initialPrompt = document.getElementById('initialPrompt');
    const highScoresList = document.getElementById('highScoresList');

    const enterpriseImg = new Image();
    enterpriseImg.src = '/Images/enterprise.png';

    const asteroidImg = new Image();
    asteroidImg.src = '/Images/asteroid_cartoon.png';

    let ship = { x: 280, y: 360, width: 40, height: 40, speed: 5 };
    let asteroids = [];
    let score = 0;
    let keys = {};
    let gameInterval;

    document.addEventListener('keydown', (e) => keys[e.key] = true);
    document.addEventListener('keyup', (e) => keys[e.key] = false);

    function goFullscreen(element) {
      if (element.requestFullscreen) {
        element.requestFullscreen();
      } else if (element.webkitRequestFullscreen) {
        element.webkitRequestFullscreen();
      } else if (element.msRequestFullscreen) {
        element.msRequestFullscreen();
      }
    }

    function startGame() {
      goFullscreen(gameContainer);

      gameContainer.style.display = 'block';
      highScoresBox.style.display = 'none';
      initialPrompt.style.display = 'none';
      ship.x = 280;
      ship.y = 360;
      asteroids = [];
      score = 0;

      gameInterval = setInterval(gameLoop, 1000 / 60);
    }

    function gameLoop() {
      update();
      draw();
    }

    function update() {
      if (keys['ArrowLeft'] && ship.x > 0) ship.x -= ship.speed;
      if (keys['ArrowRight'] && ship.x + ship.width < canvas.width) ship.x += ship.speed;
      if (keys['ArrowUp'] && ship.y > 0) ship.y -= ship.speed;
      if (keys['ArrowDown'] && ship.y + ship.height < canvas.height) ship.y += ship.speed;

      if (Math.random() < 0.02) {
        asteroids.push({
          x: Math.random() * (canvas.width - 40),
          y: -40,
          width: 40,
          height: 40,
          speed: 2 + Math.random() * 3
        });
      }

      for (let a of asteroids) {
        a.y += a.speed;
      }

      asteroids = asteroids.filter(a => a.y < canvas.height);

      for (let a of asteroids) {
        if (isColliding(ship, a)) {
          clearInterval(gameInterval);
          checkHighScore();
          return;
        }
      }

      score++;
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(enterpriseImg, ship.x, ship.y, ship.width, ship.height);

      for (let a of asteroids) {
        ctx.drawImage(asteroidImg, a.x, a.y, a.width, a.height);
      }

      ctx.fillStyle = 'white';
      ctx.font = '16px sans-serif';
      ctx.fillText(`Score: ${score}`, 10, 20);
    }

    function isColliding(r1, r2) {
      return r1.x < r2.x + r2.width &&
             r1.x + r1.width > r2.x &&
             r1.y < r2.y + r2.height &&
             r1.y + r1.height > r2.y;
    }

    function checkHighScore() {
      let highScores = JSON.parse(localStorage.getItem('highScores') || '[]');
      highScores.push(score);
      highScores.sort((a, b) => b - a);
      highScores = highScores.slice(0, 5);
      localStorage.setItem('highScores', JSON.stringify(highScores));
      displayHighScores();
    }

    function displayHighScores() {
      highScoresList.innerHTML = '';
      const highScores = JSON.parse(localStorage.getItem('highScores') || '[]');
      highScores.forEach(score => {
        const li = document.createElement('li');
        li.textContent = score;
        highScoresList.appendChild(li);
      });
      gameContainer.style.display = 'none';
      highScoresBox.style.display = 'block';
      initialPrompt.style.display = 'block';
    }

    // Show high scores on initial load
    displayHighScores();
  </script>
</body>
</html>
