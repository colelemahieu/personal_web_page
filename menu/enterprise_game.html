<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>USS Enterprise Asteroid Dodge</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: black;
      color: white;
      font-family: sans-serif;
      text-align: center;
      overflow: hidden;
    }

    h1 {
      margin-top: 1rem;
    }

    #initialPrompt {
      margin: 1rem auto;
    }

    #gameContainer {
      display: none;
      margin: 2rem auto;
      border: 2px solid white;
      padding: 1rem;
      width: 800px;
      background-color: #111;
      position: relative;
    }

    canvas {
      display: block;
      margin: 0 auto;
      background-color: black;
      border: 1px solid white;
    }

    #scoreDisplay {
      font-size: 1.5rem;
      margin-top: 0.5rem;
    }

    #gameOverMessage {
      font-size: 2rem;
      color: red;
      display: none;
    }

    #highScores {
      margin-top: 1rem;
    }

    #highScores ul {
      list-style: none;
      padding: 0;
    }

    #highScores li {
      margin: 0.25rem 0;
    }

    /* Fullscreen styles */
    :fullscreen #gameContainer,
    :-webkit-full-screen #gameContainer {
      width: 100vw;
      height: 100vh;
      max-width: none;
      aspect-ratio: unset;
      padding: 0;
      margin: 0;
    }

    :fullscreen canvas,
    :-webkit-full-screen canvas {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <h1>USS Enterprise Asteroid Dodge</h1>
  <div id="initialPrompt">
    <p>Press the button below to start the game.</p>
    <button onclick="startGame()">Start Game</button>
    <div id="highScores">
      <h3>High Scores</h3>
      <ul id="highScoreList"></ul>
    </div>
  </div>

  <div id="gameContainer">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="scoreDisplay">Score: 0</div>
    <div id="gameOverMessage">Game Over</div>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const gameContainer = document.getElementById('gameContainer');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const gameOverMessage = document.getElementById('gameOverMessage');
    const highScoresBox = document.getElementById('highScores');
    const highScoreList = document.getElementById('highScoreList');
    const initialPrompt = document.getElementById('initialPrompt');

    const ship = new Image();
    ship.src = '/Images/enterprise.png';
    let shipX = canvas.width / 2;
    let shipY = canvas.height - 60;
    const shipSpeed = 6;

    const asteroidImage = new Image();
    asteroidImage.src = '/Images/asteroid_cartoon.png';

    let score = 0;
    let gameOver = false;
    let asteroids = [];
    let keys = {};
    let lastAsteroidTime = 0;
    let lastFrameTime = 0;

    document.addEventListener('keydown', e => keys[e.key] = true);
    document.addEventListener('keyup', e => keys[e.key] = false);

    function startGame() {
      goFullscreen(gameContainer);

      gameContainer.style.display = 'block';
      highScoresBox.style.display = 'none';
      initialPrompt.style.display = 'none';

      shipX = canvas.width / 2 - ship.width / 2;
      shipY = canvas.height - ship.height - 10;
      score = 0;
      gameOver = false;
      asteroids.length = 0;
      lastAsteroidTime = 0;
      lastFrameTime = performance.now();
      requestAnimationFrame(updateGame);
    }

    function goFullscreen(element) {
      if (element.requestFullscreen) {
        element.requestFullscreen();
      } else if (element.webkitRequestFullscreen) {
        element.webkitRequestFullscreen();
      } else if (element.msRequestFullscreen) {
        element.msRequestFullscreen();
      }
    }

    function updateGame(timestamp) {
      const deltaTime = timestamp - lastFrameTime;
      lastFrameTime = timestamp;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (keys['ArrowLeft'] && shipX > 0) {
        shipX -= shipSpeed;
      }
      if (keys['ArrowRight'] && shipX < canvas.width - ship.width) {
        shipX += shipSpeed;
      }

      ctx.drawImage(ship, shipX, shipY);

      if (timestamp - lastAsteroidTime > 1000) {
        generateAsteroid();
        lastAsteroidTime = timestamp;
      }

      for (let i = 0; i < asteroids.length; i++) {
        const a = asteroids[i];
        a.y += a.speed;
        ctx.drawImage(asteroidImage, a.x, a.y, a.size, a.size);

        if (
          shipX < a.x + a.size &&
          shipX + ship.width > a.x &&
          shipY < a.y + a.size &&
          shipY + ship.height > a.y
        ) {
          endGame();
          return;
        }
      }

      asteroids = asteroids.filter(a => a.y < canvas.height);
      score += deltaTime * 0.01;
      scoreDisplay.textContent = `Score: ${Math.floor(score)}`;

      if (!gameOver) {
        requestAnimationFrame(updateGame);
      }
    }

    function generateAsteroid() {
      const size = 40 + Math.random() * 30;
      const x = Math.random() * (canvas.width - size);
      const speed = 2 + Math.random() * 3;
      asteroids.push({ x, y: -size, size, speed });
    }

    function endGame() {
      gameOver = true;
      gameOverMessage.style.display = 'block';
      setTimeout(() => {
        gameOverMessage.style.display = 'none';
        gameContainer.style.display = 'none';
        highScoresBox.style.display = 'block';
        initialPrompt.style.display = 'block';
        checkHighScore(Math.floor(score));
      }, 2000);
    }

    function checkHighScore(newScore) {
      let scores = JSON.parse(localStorage.getItem('enterpriseHighScores')) || [];
      scores.push(newScore);
      scores.sort((a, b) => b - a);
      scores = scores.slice(0, 5);
      localStorage.setItem('enterpriseHighScores', JSON.stringify(scores));
      displayHighScores();
    }

    function displayHighScores() {
      let scores = JSON.parse(localStorage.getItem('enterpriseHighScores')) || [];
      highScoreList.innerHTML = '';
      for (const s of scores) {
        const li = document.createElement('li');
        li.textContent = s;
        highScoreList.appendChild(li);
      }
    }

    window.onload = displayHighScores;
  </script>
</body>
</html>
